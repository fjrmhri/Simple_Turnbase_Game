<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Turn-Based RPG Battle</title>
    <style>
      @font-face {
        font-family: "Monocraft";
        src: url("fonts/Monocraft.otf") format("opentype"),
          url("fonts/Monocraft.ttf") format("truetype");
        font-weight: 400;
        font-style: normal;
      }

      :root {
        --bg-dark: #0b1021;
        --bg-panel: rgba(17, 23, 45, 0.8);
        --bg-card: rgba(26, 33, 66, 0.85);
        --bg-highlight: #1e2b57;
        --primary: #74f0ed;
        --secondary: #ffc857;
        --accent: #ff6b6b;
        --hp: linear-gradient(90deg, #ff8f70, #ff3d3d);
        --mp: linear-gradient(90deg, #74b9ff, #0984e3);
        --text-main: #e3ecff;
        --text-muted: #b6c2e1;
        --shadow-strong: 0 20px 45px rgba(3, 8, 20, 0.45);
      }

      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family: "Monocraft", monospace;
        background: radial-gradient(circle at 15% 20%, rgba(255, 255, 255, 0.07), transparent 30%),
          radial-gradient(circle at 80% 0%, rgba(116, 240, 237, 0.12), transparent 35%),
          linear-gradient(135deg, #0b1021 0%, #0f172e 50%, #0a1030 100%);
        color: var(--text-main);
        min-height: 100vh;
        overflow: hidden;
      }

      .page-shell {
        width: 100%;
        min-height: 100vh;
        position: relative;
      }

      header {
        position: absolute;
        top: 16px;
        left: 16px;
        right: 16px;
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding: 12px 20px;
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(116, 240, 237, 0.08), rgba(255, 200, 87, 0.08));
        border: 1px solid rgba(116, 240, 237, 0.2);
        box-shadow: var(--shadow-strong);
        z-index: 150;
      }

      .title-group h1 {
        font-size: 2.2rem;
        letter-spacing: 1px;
        color: var(--primary);
        text-shadow: 0 6px 22px rgba(116, 240, 237, 0.4);
      }

      .title-group p {
        color: var(--text-muted);
        margin-top: 4px;
        font-size: 0.95rem;
      }

      .layout {
        position: relative;
        min-height: 100vh;
        width: 100vw;
        overflow: hidden;
      }

      .panel {
        background: var(--bg-panel);
        border: 1px solid rgba(116, 240, 237, 0.18);
        border-radius: 18px;
        padding: 16px;
        box-shadow: var(--shadow-strong);
        backdrop-filter: blur(10px);
      }

      .hud {
        position: absolute;
        top: 110px;
        width: 320px;
        max-height: calc(100vh - 140px);
        overflow: hidden;
      }

      .hud-left {
        left: 18px;
      }

      .hud-right {
        right: 18px;
      }

      .dim-target {
        transition: filter 0.35s ease, opacity 0.35s ease;
      }

      body.overlay-active .dim-target,
      body.targeting .dim-target {
        filter: blur(4px) brightness(0.55);
      }

      body.overlay-active .character-card.active,
      body.targeting .character-card.active,
      body.overlay-active .skills-panel,
      body.targeting .skills-panel {
        filter: none;
      }

      .panel-title {
        font-size: 1rem;
        color: var(--secondary);
        letter-spacing: 0.8px;
        margin-bottom: 10px;
      }

      .battle-log {
        max-height: 62vh;
        overflow-y: auto;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .log-entry {
        font-size: 0.9rem;
        color: var(--text-main);
        padding: 10px 12px;
        background: rgba(255, 255, 255, 0.04);
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.04);
        opacity: 0;
        animation: fadeIn 0.4s ease forwards;
      }

      @keyframes fadeIn {
        to {
          opacity: 1;
        }
      }

      .battle-stage {
        position: relative;
        overflow: hidden;
        background: linear-gradient(200deg, rgba(10, 15, 31, 0.92), rgba(9, 13, 26, 0.7));
        border-radius: 0;
        border: none;
        min-height: 100vh;
        box-shadow: inset 0 0 80px rgba(0, 0, 0, 0.6);
      }

      .stage-overlay {
        position: absolute;
        inset: 0;
        background: radial-gradient(circle at 50% 20%, rgba(116, 240, 237, 0.15), transparent 45%),
          radial-gradient(circle at 80% 80%, rgba(255, 107, 107, 0.2), transparent 40%);
        pointer-events: none;
      }

      .battle-content {
        position: relative;
        padding: 120px 36px 56px;
        height: 100%;
        display: flex;
        flex-direction: column;
        justify-content: space-between;
        align-items: center;
      }

      .boss-area {
        display: flex;
        justify-content: center;
        margin-top: 12px;
      }

      .hero-skill-row {
        display: grid;
        grid-template-columns: auto 320px;
        align-items: end;
        gap: 26px;
        width: 100%;
        justify-content: center;
      }

      .heroes-container {
        display: flex;
        justify-content: center;
        align-items: flex-end;
        gap: 16px;
        flex-wrap: nowrap;
        padding: 16px 24px;
      }

      .character-card {
        width: 230px;
        background: var(--bg-card);
        border-radius: 18px;
        padding: 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        box-shadow: 0 14px 24px rgba(0, 0, 0, 0.35);
        position: relative;
        transition: transform 0.35s ease, box-shadow 0.35s ease, border-color 0.35s ease,
          filter 0.35s ease;
        z-index: 1;
      }

      .character-card::before {
        content: "";
        position: absolute;
        inset: 0;
        border-radius: 16px;
        background: linear-gradient(135deg, rgba(116, 240, 237, 0.08), rgba(255, 200, 87, 0.08));
        opacity: 0;
        transition: opacity 0.3s ease;
        pointer-events: none;
      }

      .character-card.active {
        transform: translateY(-10px) scale(1.02);
        border-color: rgba(116, 240, 237, 0.6);
        box-shadow: 0 18px 30px rgba(116, 240, 237, 0.22);
        z-index: 160;
      }

      .character-card.active::before {
        opacity: 1;
      }

      .character-top {
        display: flex;
        align-items: center;
        gap: 12px;
      }

      .portrait {
        width: 72px;
        height: 72px;
        background: #0c1229;
        border-radius: 14px;
        border: 1px solid rgba(255, 255, 255, 0.08);
        display: flex;
        align-items: center;
        justify-content: center;
        overflow: hidden;
        box-shadow: inset 0 0 12px rgba(0, 0, 0, 0.3);
      }

      .portrait img {
        width: 100%;
        height: 100%;
        object-fit: contain;
      }

      .character-meta {
        flex: 1;
      }

      .character-name {
        font-size: 1.1rem;
        color: var(--text-main);
      }

      .character-role {
        color: var(--text-muted);
        font-size: 0.85rem;
        letter-spacing: 0.5px;
      }

      .status-badge {
        position: absolute;
        top: 12px;
        right: 12px;
        background: rgba(255, 107, 107, 0.18);
        color: #ffb3b3;
        padding: 6px 10px;
        border-radius: 999px;
        font-size: 0.8rem;
        border: 1px solid rgba(255, 107, 107, 0.35);
      }

      .stats {
        margin-top: 14px;
        display: flex;
        flex-direction: column;
        gap: 10px;
      }

      .stat-bar {
        background: rgba(255, 255, 255, 0.05);
        padding: 8px;
        border-radius: 12px;
        border: 1px solid rgba(255, 255, 255, 0.04);
      }

      .stat-label {
        display: flex;
        justify-content: space-between;
        font-size: 0.85rem;
        color: var(--text-muted);
        margin-bottom: 6px;
      }

      .bar-container {
        width: 100%;
        height: 12px;
        background: rgba(10, 15, 31, 0.7);
        border-radius: 10px;
        overflow: hidden;
      }

      .bar-fill {
        height: 100%;
        border-radius: 10px;
        transition: width 0.4s ease;
      }

      .hp-fill {
        background: var(--hp);
      }

      .mp-fill {
        background: var(--mp);
      }

      .attributes {
        display: grid;
        grid-template-columns: repeat(3, 1fr);
        gap: 8px;
        margin-top: 12px;
      }

      .attribute {
        text-align: center;
        padding: 8px 6px;
        background: rgba(255, 255, 255, 0.03);
        border-radius: 10px;
        border: 1px solid rgba(255, 255, 255, 0.05);
        color: var(--text-muted);
      }

      .attribute strong {
        display: block;
        color: var(--text-main);
        margin-top: 4px;
      }

      .boss-card {
        width: 360px;
      }

      .skills-panel {
        position: relative;
        background: var(--bg-card);
        border-radius: 18px;
        border: 1px solid rgba(116, 240, 237, 0.25);
        padding: 18px;
        box-shadow: 0 18px 34px rgba(0, 0, 0, 0.35);
        display: none;
        z-index: 120;
      }

      .skills-panel.visible {
        display: block;
      }

      .skills-header {
        display: flex;
        align-items: center;
        justify-content: space-between;
        margin-bottom: 12px;
      }

      .skills-header h3 {
        color: var(--secondary);
        font-size: 1.05rem;
      }

      .close-panel {
        background: none;
        border: none;
        color: var(--accent);
        font-size: 1.4rem;
        cursor: pointer;
        transition: transform 0.2s ease;
      }

      .close-panel:hover {
        transform: scale(1.1);
      }

      .skills-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 10px;
      }

      .skill-button {
        background: linear-gradient(135deg, rgba(116, 240, 237, 0.24), rgba(116, 240, 237, 0.12));
        border: 1px solid rgba(116, 240, 237, 0.35);
        border-radius: 12px;
        padding: 12px 14px;
        color: var(--text-main);
        font-weight: 600;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease, border-color 0.2s ease;
        text-align: left;
      }

      .skill-button:hover:not(:disabled) {
        transform: translateY(-2px);
        box-shadow: 0 10px 18px rgba(116, 240, 237, 0.25);
        border-color: rgba(255, 200, 87, 0.6);
      }

      .skill-button:disabled {
        background: rgba(255, 255, 255, 0.05);
        border-color: rgba(255, 255, 255, 0.08);
        color: rgba(255, 255, 255, 0.4);
        cursor: not-allowed;
      }

      .skill-cost {
        font-size: 0.9rem;
        color: var(--text-muted);
      }

      .target-selector,
      .turn-overlay,
      .game-over {
        position: fixed;
        inset: 0;
        display: none;
        align-items: center;
        justify-content: center;
        z-index: 200;
      }

      .turn-overlay {
        background: rgba(7, 10, 22, 0.6);
        backdrop-filter: blur(6px);
        pointer-events: none;
        z-index: 110;
      }

      .target-selector {
        background: rgba(7, 10, 22, 0.75);
        backdrop-filter: blur(4px);
      }

      .target-panel {
        background: var(--bg-card);
        padding: 24px;
        border-radius: 16px;
        border: 1px solid rgba(116, 240, 237, 0.25);
        box-shadow: var(--shadow-strong);
        text-align: center;
        max-width: 420px;
        width: 90%;
      }

      .target-panel h3 {
        margin-bottom: 12px;
        color: var(--secondary);
      }

      .target-options {
        display: flex;
        gap: 12px;
        margin-top: 10px;
        flex-wrap: wrap;
        justify-content: center;
      }

      .target-button {
        background: linear-gradient(135deg, rgba(255, 200, 87, 0.2), rgba(255, 200, 87, 0.12));
        border: 1px solid rgba(255, 200, 87, 0.4);
        color: var(--text-main);
        padding: 12px 18px;
        border-radius: 12px;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .target-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 10px 20px rgba(255, 200, 87, 0.25);
      }

      .game-over {
        background: rgba(0, 0, 0, 0.8);
      }

      .game-over-content {
        background: var(--bg-card);
        border-radius: 20px;
        padding: 32px;
        text-align: center;
        border: 3px solid;
        max-width: 500px;
        width: 90%;
        box-shadow: var(--shadow-strong);
      }

      .victory {
        border-color: #27ae60;
      }

      .defeat {
        border-color: #ff6b6b;
      }

      .game-over-title {
        font-size: 2.8rem;
        margin-bottom: 12px;
      }

      .victory-title {
        color: #27ae60;
      }

      .defeat-title {
        color: #ff6b6b;
      }

      .restart-button {
        background: linear-gradient(135deg, rgba(116, 240, 237, 0.25), rgba(116, 240, 237, 0.18));
        border: 1px solid rgba(116, 240, 237, 0.5);
        border-radius: 12px;
        padding: 12px 22px;
        color: var(--text-main);
        font-size: 1.05rem;
        cursor: pointer;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
      }

      .restart-button:hover {
        transform: translateY(-2px);
        box-shadow: 0 12px 20px rgba(116, 240, 237, 0.25);
      }

      .damage-text {
        position: absolute;
        font-weight: bold;
        font-size: 1.2rem;
        animation: floatUp 1s ease-out forwards;
        z-index: 500;
        text-shadow: 0 6px 10px rgba(0, 0, 0, 0.35);
      }

      @keyframes floatUp {
        0% {
          transform: translateY(0);
          opacity: 1;
        }
        100% {
          transform: translateY(-50px);
          opacity: 0;
        }
      }

      .damage {
        color: var(--accent);
      }

      .heal {
        color: #5adf9c;
      }

      .buff {
        color: #74f0ed;
      }

      .debuff {
        color: #c792ea;
      }

      @media (max-width: 1200px) {
        .battle-log {
          height: 200px;
        }

        .hero-skill-row {
          grid-template-columns: 1fr;
        }

        .skills-panel {
          position: relative;
        }

        .heroes-container {
          flex-wrap: wrap;
        }
      }
    </style>
  </head>
  <body>
    <div class="page-shell">
      <header class="dim-target">
        <div class="title-group">
          <h1>Crystal Citadel Clash</h1>
          <p>Guide your squad through a cinematic duel against the Dragon Lord.</p>
        </div>
      </header>

      <div class="layout">
        <div class="battle-stage">
          <div class="stage-overlay dim-target"></div>

          <div class="hud hud-left panel dim-target">
            <div class="panel-title">Battle Feed</div>
            <div class="battle-log" id="battleLog"></div>
          </div>

          <div class="hud hud-right panel dim-target">
            <div class="panel-title">Status</div>
            <p style="color: var(--text-muted); line-height: 1.5">
              Watch for glowing borders to see whose turn it is. When choosing a move,
              the arena softly dims so you can focus on the active hero and the target.
            </p>
          </div>

          <div class="battle-content">
            <div class="boss-area dim-target">
              <div class="character-card boss-card dim-target" id="bossCard">
                <div class="character-top">
                  <div class="portrait">
                    <img src="gif/dragon.gif" alt="Dragon" />
                  </div>
                  <div class="character-meta">
                    <div class="character-name">Dragon Lord</div>
                    <div class="character-role">Boss</div>
                  </div>
                  <div class="status-badge" id="bossStatus"></div>
                </div>
                <div class="stats">
                  <div class="stat-bar">
                    <div class="stat-label">
                      <span>HP</span>
                      <span id="bossHpText">800/800</span>
                    </div>
                    <div class="bar-container">
                      <div class="bar-fill hp-fill" id="bossHpBar" style="width: 100%"></div>
                    </div>
                  </div>
                </div>
                <div class="attributes">
                  <div class="attribute">
                    ATK<strong>35</strong>
                  </div>
                  <div class="attribute">
                    DEF<strong>15</strong>
                  </div>
                  <div class="attribute">
                    MAG<strong>25</strong>
                  </div>
                </div>
              </div>
            </div>

            <div class="hero-skill-row">
              <div class="heroes-container dim-target">
                <div class="character-card dim-target" id="soldierCard" data-character="soldier">
                  <div class="character-top">
                    <div class="portrait">
                      <img src="gif/soldier.gif" alt="Soldier" />
                    </div>
                    <div class="character-meta">
                      <div class="character-name">Soldier</div>
                      <div class="character-role">Physical DPS</div>
                    </div>
                    <div class="status-badge" id="soldierStatus"></div>
                  </div>
                  <div class="stats">
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>HP</span>
                        <span id="soldierHpText">120/120</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill hp-fill" id="soldierHpBar" style="width: 100%"></div>
                      </div>
                    </div>
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>MP</span>
                        <span id="soldierMpText">40/40</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill mp-fill" id="soldierMpBar" style="width: 100%"></div>
                      </div>
                    </div>
                  </div>
                  <div class="attributes">
                    <div class="attribute">
                      ATK<strong>25</strong>
                    </div>
                    <div class="attribute">
                      DEF<strong>10</strong>
                    </div>
                    <div class="attribute">
                      MAG<strong>5</strong>
                    </div>
                  </div>
                </div>

                <div class="character-card dim-target" id="mageCard" data-character="mage">
                  <div class="character-top">
                    <div class="portrait">
                      <img src="gif/mage.gif" alt="Mage" />
                    </div>
                    <div class="character-meta">
                      <div class="character-name">Mage</div>
                      <div class="character-role">Magic DPS</div>
                    </div>
                    <div class="status-badge" id="mageStatus"></div>
                  </div>
                  <div class="stats">
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>HP</span>
                        <span id="mageHpText">80/80</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill hp-fill" id="mageHpBar" style="width: 100%"></div>
                      </div>
                    </div>
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>MP</span>
                        <span id="mageMpText">100/100</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill mp-fill" id="mageMpBar" style="width: 100%"></div>
                      </div>
                    </div>
                  </div>
                  <div class="attributes">
                    <div class="attribute">
                      ATK<strong>5</strong>
                    </div>
                    <div class="attribute">
                      DEF<strong>5</strong>
                    </div>
                    <div class="attribute">
                      MAG<strong>30</strong>
                    </div>
                  </div>
                </div>

                <div class="character-card dim-target" id="healerCard" data-character="healer">
                  <div class="character-top">
                    <div class="portrait">
                      <img src="gif/healer.gif" alt="Healer" />
                    </div>
                    <div class="character-meta">
                      <div class="character-name">Healer</div>
                      <div class="character-role">Support</div>
                    </div>
                    <div class="status-badge" id="healerStatus"></div>
                  </div>
                  <div class="stats">
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>HP</span>
                        <span id="healerHpText">100/100</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill hp-fill" id="healerHpBar" style="width: 100%"></div>
                      </div>
                    </div>
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>MP</span>
                        <span id="healerMpText">80/80</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill mp-fill" id="healerMpBar" style="width: 100%"></div>
                      </div>
                    </div>
                  </div>
                  <div class="attributes">
                    <div class="attribute">
                      ATK<strong>8</strong>
                    </div>
                    <div class="attribute">
                      DEF<strong>8</strong>
                    </div>
                    <div class="attribute">
                      MAG<strong>15</strong>
                    </div>
                  </div>
                </div>

                <div class="character-card dim-target" id="tankCard" data-character="tank">
                  <div class="character-top">
                    <div class="portrait">
                      <img src="gif/tank.gif" alt="Tank" />
                    </div>
                    <div class="character-meta">
                      <div class="character-name">Tank</div>
                      <div class="character-role">Defender</div>
                    </div>
                    <div class="status-badge" id="tankStatus"></div>
                  </div>
                  <div class="stats">
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>HP</span>
                        <span id="tankHpText">180/180</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill hp-fill" id="tankHpBar" style="width: 100%"></div>
                      </div>
                    </div>
                    <div class="stat-bar">
                      <div class="stat-label">
                        <span>MP</span>
                        <span id="tankMpText">50/50</span>
                      </div>
                      <div class="bar-container">
                        <div class="bar-fill mp-fill" id="tankMpBar" style="width: 100%"></div>
                      </div>
                    </div>
                  </div>
                  <div class="attributes">
                    <div class="attribute">
                      ATK<strong>15</strong>
                    </div>
                    <div class="attribute">
                      DEF<strong>20</strong>
                    </div>
                    <div class="attribute">
                      MAG<strong>5</strong>
                    </div>
                  </div>
                </div>
              </div>

              <div class="skills-panel" id="skillsPanel">
                <div class="skills-header">
                  <h3 id="skillsHeader">Skills</h3>
                  <button class="close-panel" id="closeSkills">âœ•</button>
                </div>
                <div class="skills-grid" id="skillsGrid"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="turn-overlay" id="turnOverlay"></div>

    <div class="target-selector" id="targetSelector">
      <div class="target-panel">
        <h3>Select Target</h3>
        <div class="target-options" id="targetOptions"></div>
      </div>
    </div>

    <div class="game-over" id="gameOver">
      <div class="game-over-content" id="gameOverContent">
        <div class="game-over-title" id="gameOverTitle">VICTORY!</div>
        <p id="gameOverMessage">
          Your party stands triumphant amid shimmering stardust.
        </p>
        <button class="restart-button" id="restartButton">Restart Battle</button>
      </div>
    </div>

    <script>
      class RPGGame {
        constructor() {
          this.characters = {
            soldier: {
              id: "soldier",
              name: "Soldier",
              role: "Physical DPS",
              maxHp: 120,
              hp: 120,
              maxMp: 40,
              mp: 40,
              atk: 25,
              def: 10,
              mag: 5,
              status: null,
              skills: [
                {
                  id: "basicAttack",
                  name: "Basic Attack",
                  cost: 0,
                  type: "physical",
                  target: "single",
                },
                {
                  id: "powerStrike",
                  name: "Power Strike",
                  cost: 15,
                  type: "physical",
                  target: "single",
                },
                {
                  id: "armorBreak",
                  name: "Armor Break",
                  cost: 20,
                  type: "debuff",
                  target: "single",
                },
              ],
            },
            mage: {
              id: "mage",
              name: "Mage",
              role: "Magic DPS",
              maxHp: 80,
              hp: 80,
              maxMp: 100,
              mp: 100,
              atk: 5,
              def: 5,
              mag: 30,
              status: null,
              skills: [
                {
                  id: "magicBolt",
                  name: "Magic Bolt",
                  cost: 10,
                  type: "magical",
                  target: "single",
                },
                {
                  id: "firestorm",
                  name: "Firestorm",
                  cost: 30,
                  type: "aoe",
                  target: "all",
                },
                {
                  id: "focus",
                  name: "Focus",
                  cost: 0,
                  type: "buff",
                  target: "self",
                },
              ],
            },
            healer: {
              id: "healer",
              name: "Healer",
              role: "Support",
              maxHp: 100,
              hp: 100,
              maxMp: 80,
              mp: 80,
              atk: 8,
              def: 8,
              mag: 15,
              status: null,
              skills: [
                {
                  id: "heal",
                  name: "Heal",
                  cost: 20,
                  type: "heal",
                  target: "single",
                },
                {
                  id: "groupHeal",
                  name: "Group Heal",
                  cost: 35,
                  type: "groupHeal",
                  target: "all",
                },
                {
                  id: "purify",
                  name: "Purify",
                  cost: 25,
                  type: "cleanse",
                  target: "single",
                },
                {
                  id: "basicAttack",
                  name: "Basic Attack",
                  cost: 0,
                  type: "physical",
                  target: "single",
                },
              ],
            },
            tank: {
              id: "tank",
              name: "Tank",
              role: "Defender",
              maxHp: 180,
              hp: 180,
              maxMp: 50,
              mp: 50,
              atk: 15,
              def: 20,
              mag: 5,
              status: null,
              skills: [
                {
                  id: "guard",
                  name: "Guard",
                  cost: 0,
                  type: "defend",
                  target: "self",
                },
                {
                  id: "provoke",
                  name: "Provoke",
                  cost: 15,
                  type: "taunt",
                  target: "self",
                },
                {
                  id: "shieldWall",
                  name: "Shield Wall",
                  cost: 25,
                  type: "partyBuff",
                  target: "all",
                },
              ],
            },
          };

          this.boss = {
            id: "boss",
            name: "Dragon Lord",
            maxHp: 800,
            hp: 800,
            atk: 35,
            def: 15,
            mag: 25,
            status: null,
          };

          this.turnOrder = ["soldier", "mage", "healer", "tank", "boss"];
          this.currentTurn = 0;
          this.gameState = "playing"; // playing, victory, defeat
          this.activeSkill = null;
          this.buffEffects = {};
          this.debuffEffects = {};

          this.initializeEventListeners();
          this.updateUI();
        }

        initializeEventListeners() {
          document
            .getElementById("closeSkills")
            .addEventListener("click", () => {
              this.hideSkillsPanel();
            });

          document
            .getElementById("restartButton")
            .addEventListener("click", () => {
              this.resetGame();
            });
        }

        getCurrentCharacter() {
          return this.turnOrder[this.currentTurn] === "boss"
            ? this.boss
            : this.characters[this.turnOrder[this.currentTurn]];
        }

        isPlayerTurn() {
          return (
            this.turnOrder[this.currentTurn] !== "boss" &&
            this.gameState === "playing"
          );
        }

        updateUI() {
          // Update boss
          const bossHpPercent = (this.boss.hp / this.boss.maxHp) * 100;
          document.getElementById(
            "bossHpBar"
          ).style.width = `${bossHpPercent}%`;
          document.getElementById(
            "bossHpText"
          ).textContent = `${this.boss.hp}/${this.boss.maxHp}`;
          document.getElementById("bossStatus").textContent =
            this.boss.status || "";
          document.getElementById("bossStatus").style.display = this.boss.status
            ? "block"
            : "none";

          // Update characters
          Object.keys(this.characters).forEach((charId) => {
            const char = this.characters[charId];
            const hpPercent = (char.hp / char.maxHp) * 100;
            const mpPercent = (char.mp / char.maxMp) * 100;

            document.getElementById(
              `${charId}HpBar`
            ).style.width = `${hpPercent}%`;
            document.getElementById(
              `${charId}MpBar`
            ).style.width = `${mpPercent}%`;
            document.getElementById(
              `${charId}HpText`
            ).textContent = `${char.hp}/${char.maxHp}`;
            document.getElementById(
              `${charId}MpText`
            ).textContent = `${char.mp}/${char.maxMp}`;
            document.getElementById(`${charId}Status`).textContent =
              char.status || "";
            document.getElementById(`${charId}Status`).style.display =
              char.status ? "block" : "none";

            // Highlight active character
            const card = document.getElementById(`${charId}Card`);
            if (
              this.isPlayerTurn() &&
              this.turnOrder[this.currentTurn] === charId
            ) {
              card.classList.add("active");
            } else {
              card.classList.remove("active");
            }
          });

          // Check win/lose conditions
          this.checkGameEnd();
        }

        checkGameEnd() {
          if (this.boss.hp <= 0 && this.gameState === "playing") {
            this.gameState = "victory";
            this.showGameOver("victory");
            return;
          }

          const aliveHeroes = Object.values(this.characters).filter(
            (char) => char.hp > 0
          );
          if (aliveHeroes.length === 0 && this.gameState === "playing") {
            this.gameState = "defeat";
            this.showGameOver("defeat");
          }
        }

        showGameOver(result) {
          const gameOver = document.getElementById("gameOver");
          const gameOverContent = document.getElementById("gameOverContent");
          const gameOverTitle = document.getElementById("gameOverTitle");

          if (result === "victory") {
            gameOverTitle.textContent = "VICTORY!";
            gameOverTitle.className = "game-over-title victory-title";
            gameOverContent.className = "game-over-content victory";
          } else {
            gameOverTitle.textContent = "DEFEAT!";
            gameOverTitle.className = "game-over-title defeat-title";
            gameOverContent.className = "game-over-content defeat";
          }

          gameOver.style.display = "flex";
        }

        resetGame() {
          // Reset characters
          Object.keys(this.characters).forEach((charId) => {
            const char = this.characters[charId];
            char.hp = char.maxHp;
            char.mp = char.maxMp;
            char.status = null;
          });

          // Reset boss
          this.boss.hp = this.boss.maxHp;
          this.boss.status = null;

          // Reset game state
          this.currentTurn = 0;
          this.gameState = "playing";
          this.activeSkill = null;
          this.buffEffects = {};
          this.debuffEffects = {};

          // Hide overlays
          document.getElementById("turnOverlay").style.display = "none";
          document.body.classList.remove("overlay-active");
          document.body.classList.remove("targeting");
          document.getElementById("skillsPanel").style.display = "none";
          document.getElementById("targetSelector").style.display = "none";
          document.getElementById("gameOver").style.display = "none";

          this.updateUI();
          this.processTurn();
        }

        processTurn() {
          if (this.gameState !== "playing") return;

          const currentChar = this.getCurrentCharacter();

          if (this.turnOrder[this.currentTurn] === "boss") {
            setTimeout(() => {
              this.executeBossTurn();
            }, 1500);
          } else {
            // Player turn
            this.showSkillsPanel(currentChar);
          }
        }

        showSkillsPanel(character) {
          const panel = document.getElementById("skillsPanel");
          const header = document.getElementById("skillsGrid");
          const overlay = document.getElementById("turnOverlay");

          header.innerHTML = "";

          character.skills.forEach((skill) => {
            const button = document.createElement("button");
            button.className = "skill-button";
            button.innerHTML = `
                        <div>${skill.name}</div>
                        <div class="skill-cost">${
                          skill.cost > 0 ? `${skill.cost} MP` : "No Cost"
                        }</div>
                    `;

            if (character.mp < skill.cost) {
              button.disabled = true;
            }

            button.addEventListener("click", () => {
              this.selectSkill(skill);
            });

            header.appendChild(button);
          });

          document.getElementById(
            "skillsHeader"
          ).textContent = `${character.name}'s Skills`;
          overlay.style.display = "block";
          document.body.classList.add("overlay-active");
          panel.style.display = "block";
        }

        hideSkillsPanel() {
          document.getElementById("turnOverlay").style.display = "none";
          document.body.classList.remove("overlay-active");
          document.getElementById("skillsPanel").style.display = "none";
        }

        selectSkill(skill) {
          this.activeSkill = skill;
          this.hideSkillsPanel();

          if (skill.target === "self") {
            this.executeSkill(
              this.getCurrentCharacter(),
              skill,
              this.getCurrentCharacter()
            );
          } else if (skill.target === "all") {
            this.executeSkill(this.getCurrentCharacter(), skill, "all");
          } else {
            this.showTargetSelector(skill);
          }
        }

        showTargetSelector(skill) {
          const selector = document.getElementById("targetSelector");
          const options = document.getElementById("targetOptions");
          options.innerHTML = "";

          if (
            skill.type === "heal" ||
            skill.type === "groupHeal" ||
            skill.type === "cleanse"
          ) {
            // Show ally targets
            Object.keys(this.characters).forEach((charId) => {
              const char = this.characters[charId];
              if (char.hp > 0) {
                const button = document.createElement("button");
                button.className = "target-button";
                button.textContent = char.name;
                button.addEventListener("click", () => {
                  this.executeSkill(this.getCurrentCharacter(), skill, char);
                });
                options.appendChild(button);
              }
            });
          } else {
            // Show enemy target (boss)
            const button = document.createElement("button");
            button.className = "target-button";
            button.textContent = this.boss.name;
            button.addEventListener("click", () => {
              this.executeSkill(this.getCurrentCharacter(), skill, this.boss);
            });
            options.appendChild(button);
          }

          document.body.classList.add("targeting");
          selector.style.display = "flex";
        }

        hideTargetSelector() {
          document.body.classList.remove("targeting");
          document.getElementById("targetSelector").style.display = "none";
        }

        calculateDamage(attacker, defender, baseDamage, isMagical = false) {
          const attackStat = isMagical ? attacker.mag : attacker.atk;
          const defenseStat = isMagical ? defender.def / 2 : defender.def;
          const variance = Math.floor(Math.random() * 10) - 5;
          return Math.max(
            1,
            Math.floor(baseDamage + attackStat - defenseStat + variance)
          );
        }

        showDamageText(targetElement, amount, type) {
          const rect = targetElement.getBoundingClientRect();
          const damageText = document.createElement("div");
          damageText.className = `damage-text ${type}`;
          damageText.textContent =
            type === "damage"
              ? `-${amount}`
              : type === "heal"
              ? `+${amount}`
              : amount;
          damageText.style.left = `${rect.left + rect.width / 2}px`;
          damageText.style.top = `${rect.top}px`;

          document.body.appendChild(damageText);

          setTimeout(() => {
            document.body.removeChild(damageText);
          }, 1000);
        }

        executeSkill(caster, skill, target) {
          this.hideTargetSelector();
          let logMessage = "";

          // Deduct MP
          if (skill.cost > 0) {
            caster.mp = Math.max(0, caster.mp - skill.cost);
          }

          switch (skill.type) {
            case "physical":
              if (target === this.boss) {
                const damage = this.calculateDamage(caster, target, 15, false);
                this.boss.hp = Math.max(0, this.boss.hp - damage);
                logMessage = `${caster.name} uses ${skill.name} on ${this.boss.name} for ${damage} damage!`;
                this.showDamageText(
                  document.getElementById("bossCard"),
                  damage,
                  "damage"
                );
              }
              break;

            case "magical":
              if (target === this.boss) {
                const damage = this.calculateDamage(caster, target, 20, true);
                this.boss.hp = Math.max(0, this.boss.hp - damage);
                logMessage = `${caster.name} casts ${skill.name} on ${this.boss.name} for ${damage} damage!`;
                this.showDamageText(
                  document.getElementById("bossCard"),
                  damage,
                  "damage"
                );
              }
              break;

            case "aoe":
              if (target === "all") {
                const damage = this.calculateDamage(
                  caster,
                  this.boss,
                  25,
                  true
                );
                this.boss.hp = Math.max(0, this.boss.hp - damage);
                logMessage = `${caster.name} casts ${skill.name} for ${damage} damage to ${this.boss.name}!`;
                this.showDamageText(
                  document.getElementById("bossCard"),
                  damage,
                  "damage"
                );
              }
              break;

            case "heal":
              const healAmount = Math.floor(Math.random() * 30) + 40;
              target.hp = Math.min(target.maxHp, target.hp + healAmount);
              logMessage = `${caster.name} heals ${target.name} for ${healAmount} HP!`;
              this.showDamageText(
                document.getElementById(`${target.id}Card`),
                healAmount,
                "heal"
              );
              break;

            case "groupHeal":
              const groupHealAmount = Math.floor(Math.random() * 15) + 20;
              Object.values(this.characters).forEach((char) => {
                if (char.hp > 0) {
                  char.hp = Math.min(char.maxHp, char.hp + groupHealAmount);
                  this.showDamageText(
                    document.getElementById(`${char.id}Card`),
                    groupHealAmount,
                    "heal"
                  );
                }
              });
              logMessage = `${caster.name} casts Group Heal for ${groupHealAmount} HP to all allies!`;
              break;

            case "defend":
              caster.status = "Defending";
              logMessage = `${caster.name} takes a defensive stance!`;
              break;

            case "taunt":
              caster.status = "Taunting";
              logMessage = `${caster.name} provokes the boss!`;
              break;

            case "buff":
              caster.status = "Focused";
              logMessage = `${caster.name} focuses their energy!`;
              break;

            case "debuff":
              if (target === this.boss) {
                this.boss.status = "Armor Broken";
                logMessage = `${caster.name} breaks ${this.boss.name}'s armor!`;
                this.showDamageText(
                  document.getElementById("bossCard"),
                  "Armor Broken",
                  "debuff"
                );
              }
              break;
          }

          this.addToLog(logMessage);
          this.updateUI();

          // Move to next turn
          setTimeout(() => {
            this.nextTurn();
          }, 1000);
        }

        executeBossTurn() {
          const aliveHeroes = Object.values(this.characters).filter(
            (char) => char.hp > 0
          );
          if (aliveHeroes.length === 0) return;

          let logMessage = "";
          const tauntedHero = aliveHeroes.find(
            (hero) => hero.status === "Taunting"
          );

          if (tauntedHero && Math.random() > 0.3) {
            // 70% chance to attack taunted hero
            const damage = this.calculateDamage(
              this.boss,
              tauntedHero,
              30,
              false
            );
            tauntedHero.hp = Math.max(0, tauntedHero.hp - damage);
            logMessage = `${this.boss.name} attacks ${tauntedHero.name} for ${damage} damage!`;
            this.showDamageText(
              document.getElementById(`${tauntedHero.id}Card`),
              damage,
              "damage"
            );
            // Clear taunt status
            tauntedHero.status = null;
          } else {
            // Choose attack pattern
            if (Math.random() > 0.7 && aliveHeroes.length > 2) {
              // 30% chance for AoE if many heroes alive
              aliveHeroes.forEach((hero) => {
                const damage = this.calculateDamage(this.boss, hero, 15, true);
                hero.hp = Math.max(0, hero.hp - damage);
                this.showDamageText(
                  document.getElementById(`${hero.id}Card`),
                  damage,
                  "damage"
                );
              });
              logMessage = `${this.boss.name} breathes fire on all heroes for 15 damage each!`;
            } else {
              // Single target attack on weakest hero
              const weakestHero = aliveHeroes.reduce((weakest, hero) =>
                hero.hp < weakest.hp ? hero : weakest
              );
              const damage = this.calculateDamage(
                this.boss,
                weakestHero,
                35,
                false
              );
              weakestHero.hp = Math.max(0, weakestHero.hp - damage);
              logMessage = `${this.boss.name} attacks ${weakestHero.name} for ${damage} damage!`;
              this.showDamageText(
                document.getElementById(`${weakestHero.id}Card`),
                damage,
                "damage"
              );
            }
          }

          this.addToLog(logMessage);
          this.updateUI();

          // Move to next turn
          setTimeout(() => {
            this.nextTurn();
          }, 1000);
        }

        nextTurn() {
          this.currentTurn = (this.currentTurn + 1) % this.turnOrder.length;
          this.processTurn();
        }

        addToLog(message) {
          const log = document.getElementById("battleLog");
          const entry = document.createElement("div");
          entry.className = "log-entry";
          entry.textContent = message;
          log.appendChild(entry);
          log.scrollTop = log.scrollHeight;
        }
      }

      // Initialize game when page loads
      document.addEventListener("DOMContentLoaded", () => {
        const game = new RPGGame();
        game.processTurn();
      });
    </script>
  </body>
</html>
